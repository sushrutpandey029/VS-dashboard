<!DOCTYPE html>
<html lang="en">



<head>
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, user-scalable=0">
    <link rel="shortcut icon" type="image/x-icon" href="../assets/img/favicon.ico">
    <title>VS dashboard</title>
    <link rel="stylesheet" type="text/css" href="../css/bootstrap.min.css">
    <link rel="stylesheet" type="text/css" href="../css/font-awesome.min.css">
    <link rel="stylesheet" type="text/css" href="../css/select2.min.css">
    <link rel="stylesheet" type="text/css" href="../css/bootstrap-datetimepicker.min.css">
    <link rel="stylesheet" type="text/css" href="../css/style.css">
	 <script src="https://cdnjs.cloudflare.com/ajax/libs/Chart.js/2.9.4/Chart.js"></script>
</head>

<body>
    <div class="main-wrapper">
      {{>header}}
      {{>sidebar}}
        <div class="page-wrapper">
            <div class="content">

                <div class="row">
                    <div class="col-md-6 col-sm-6 col-lg-6 col-xl-3">
                        <div class="dash-widget">
							<span class="dash-widget-bg1"><i class="fa fa-stethoscope" aria-hidden="true"></i></span>
							<div class="dash-widget-info text-right">
								<h3>{{docData.length}}</h3>
								<span class="widget-title1">Doctors <i class="fa fa-check" aria-hidden="true"></i></span>
							</div>
                        </div>
                    </div>
                    <div class="col-md-6 col-sm-6 col-lg-6 col-xl-3">
                        <div class="dash-widget">
                            <span class="dash-widget-bg2"><i class="fa fa-user-o"></i></span>
                            <div class="dash-widget-info text-right">
                                <h3>{{patientdata.length}}</h3>
                                <span class="widget-title2">Patients <i class="fa fa-check" aria-hidden="true"></i></span>
                            </div>
                        </div>
                    </div>
                    <div class="col-md-6 col-sm-6 col-lg-6 col-xl-3">
                        <div class="dash-widget">
                            <span class="dash-widget-bg3"><i class="fa fa-user-md" aria-hidden="true"></i></span>
                            <div class="dash-widget-info text-right">
                                <h3>{{gameData.length}}</h3>
                                <span class="widget-title3">Games <i class="fa fa-check" aria-hidden="true"></i></span>
                            </div>
                        </div>
                    </div>
                    
                    {{!-- <div class="col-md-6 col-sm-6 col-lg-6 col-xl-3">
                        <div class="dash-widget">
                            <span class="dash-widget-bg4"><i class="fa fa-heartbeat" aria-hidden="true"></i></span>
                            <div class="dash-widget-info text-right">
                                <h3>618</h3>
                                <span class="widget-title4">Pending <i class="fa fa-check" aria-hidden="true"></i></span>
                            </div>
                        </div>
                    </div> --}}
                </div>
				 <div class="row">
					<div class="col-12 col-md-6 col-lg-6 col-xl-6">
						<div class="card">
							<div class="card-body">
								<div class="chart-title">
									<h4>Doctors</h4>
								
								</div>	
								   <canvas id="myChart" style="width:100%;max-width:600px"></canvas>
          <button onClick="timeFrame('day')" >Day</button>
          <button onclick="timeFrame('month')">Month</button>
          <button onclick="timeFrame('year')" >Year</button>
          <input onchange="filterData()" type="date" id="startdate" value="">
          <input onchange="filterData()" type="date" id="enddate" value="">     
							</div>
						</div>
					</div>

					<div class="col-12 col-md-6 col-lg-6 col-xl-6">
						<div class="card">
							<div class="card-body">
								<div class="chart-title">
									<h4>Patients</h4>
								</div>	
								 <canvas id="myChartp" style="width:100%;max-width:600px"></canvas>
                 <button onClick="timeFramep('day')" >Day</button>
                 <button onclick="timeFramep('month')">Month</button>
                 <button onclick="timeFramep('year')" >Year</button>
          <input onchange="filterDatap()" type="date" id="startdatep" value="">
          <input onchange="filterDatap()" type="date" id="enddatep" value="">     
							</div>
						</div>
					</div>
				</div>

        <script type="text/javascript" src="https://cdn.jsdelivr.net/npm/chart.js"></script>
        <script src="https://cdn.jsdelivr.net/npm/chartjs-adapter-date-fns/dist/chartjs-adapter-date-fns.bundle.min.js"></script>


        <script  myvar={{graphDataDoc}}>

          var unique = (a,t={}) => a.filter(e=>!(t[e]=e in t)); // function to find unique dates
          var temp = document.currentScript.getAttribute('myvar'); 
          var arr2=temp.split(","); // spliting from iso date to normal date
         var datapoints=[];
          var curr=1;
         for(var i=1;i<arr2.length;i++){ //counting occurance of each element
            if(arr2[i-1]===arr2[i]){
              ++curr;
            }else{
              datapoints.push(curr);
              curr=1;
            }
         } 
          datapoints.push(curr);
          arr2=unique(arr2);
          var day=[];
          for(var i=0;i<arr2.length;i++){
             day.push({x:Date.parse(arr2[i]),y:datapoints[i]});
          }

          // console.log(day);
        
          var data = {
            labels: arr2,
            datasets: [{
              label: 'Doctors',
              data: day,
              backgroundColor: "rgba(0,0,255,1.0)",
              borderColor: "rgba(0,0,255,0.1)",
              borderWidth: 1
            }]
          };
          var config = {
            type: 'line',
            data,
            options: {
              scales: {
                x:{
                  type: 'time',
                  time:{
                    unit: 'month'
                  }
                },
                y: {
                  beginAtZero: true
                }
              }
            }
          };
          const myChart = new Chart(
            document.getElementById('myChart'),
            config
          );

          function timeFrame(period){
            if(period=='day'){
              myChart.config.options.scales.x.time.unit=period;
              myChart.config.data.datasets[0].data=day;
            }else if(period=='month'){
              myChart.config.options.scales.x.time.unit=period;
              myChart.config.data.datasets[0].data=day;
            }else if(period=='year'){
              myChart.config.options.scales.x.time.unit=period;
              myChart.config.data.datasets[0].data=day;
            }
            myChart.update();
          }

          function filterData(){
            var dates2=[...arr2];
            const startdate=document.getElementById('startdate');
            const enddate=document.getElementById('enddate');
           const indexstartdate=dates2.findIndex(function(date) {
                            return date >=startdate.value;
                        });
           var indexenddate=dates2.findIndex(function(date) {        
                      if(date==enddate.value){
                          return date;
                        }else if(date>enddate.value){
                          return date;
                        }
                        });
                        if(indexenddate==-1){
                          indexenddate=dates2.length-1;
                        }
           const filterDate= dates2.slice(indexstartdate,indexenddate+1);
            myChart.config.data.labels=filterDate;
            var datapoints2=[...datapoints]
            const filterDatapoints=datapoints2.slice(indexstartdate,indexenddate+1);
            myChart.config.data.datasets[0].data=filterDatapoints;

            myChart.update();
       
          }

          </script> 
<!-- //paitent chart -->
				   <script myvar={{graphDataPatient}}>
              
          var unique = (a,t={}) => a.filter(e=>!(t[e]=e in t)); // function to find unique dates
          var temp = document.currentScript.getAttribute('myvar'); 
          var arr2=temp.split(","); // spliting from iso date to normal date
         var datapoints=[];
          var curr=1;
         for(var i=1;i<arr2.length;i++){ //counting occurance of each element
            if(arr2[i-1]===arr2[i]){
              ++curr;
            }else{
              datapoints.push(curr);
              curr=1;
            }
         }
          datapoints.push(curr);
          arr2=unique(arr2);
          var day=[];
          for(var i=0;i<arr2.length;i++){
             day.push({x:Date.parse(arr2[i]),y:datapoints[i]});
          }
          var data = {
            labels: arr2,
            datasets: [{
              label: 'Patients',
              data: day,
              backgroundColor: "rgba(0,0,255,1.0)",
              borderColor: "rgba(0,0,255,0.1)",
              borderWidth: 1
            }]
          };
          var config = {
            type: 'line',
            data,
            options: {
              scales: {
                x:{
                  type: 'time',
                  time:{
                    unit: 'month'
                  }
                },
                y: {
                  beginAtZero: true
                }
              }
            }
          };
          const myChartp = new Chart(
            document.getElementById('myChartp'),
            config
          );

          function timeFramep(period){
            console.log(period)
            if(period=='day'){
              myChartp.config.options.scales.x.time.unit=period;
              myChartp.config.data.datasets[0].data=day;
            }else if(period=='month'){
              myChartp.config.options.scales.x.time.unit=period;
              myChartp.config.data.datasets[0].data=day;
            }else if(period=='year'){
              myChartp.config.options.scales.x.time.unit=period;
              myChartp.config.data.datasets[0].data=day;
            }
            myChartp.update();
          }

          function filterDatap(){
            var dates2=[...arr2];
            const startdatep=document.getElementById('startdatep');
            const enddatep=document.getElementById('enddatep');
           const indexstartdate=dates2.findIndex(function(date) {
                            return date >=startdate.value;
                        });
           var indexenddate=dates2.findIndex(function(date) {        
                      if(date==enddatep.value){
                          return date;
                        }else if(date>enddatep.value){
                          return date;
                        }
                        });
                        if(indexenddate==-1){
                          indexenddate=dates2.length-1;
                        }
           const filterDate= dates2.slice(indexstartdate,indexenddate+1);
            myChart.config.data.labels=filterDate;
            var datapoints2=[...datapoints]
            const filterDatapoints=datapoints2.slice(indexstartdate,indexenddate+1);
            myChart.config.data.datasets[0].data=filterDatapoints;

            myChartp.update();
       
          }
                  </script>
			
				<div class="row">
					<div class="col-12 col-md-6 col-lg-6 col-xl-6">
						<div class="card">
							<div class="card-header">
								<h4 class="card-title d-inline-block">New Patients </h4>
							</div>
							<div class="card-block">
								<div class="table-responsive">
									<table class="table mb-0 new-patient-table">
										 {{#each patientdata}}
										<tbody>
											<tr>
												<td>
													<img width="28" height="28" class="rounded-circle" src="img/user.jpg" alt=""> 
													<h2>{{this.patientFullName}}</h2>
												</td>
												<td>{{this.email}}</td>
												<td>{{this.phone}}</td>
												<td><button class="btn btn-primary btn-primary-one float-right">{{this.disabalityType}}</button></td>
											</tr>
									
										</tbody>
										 {{/each}}
									</table>
								</div>
							</div>
						</div>
					</div>

					<div class="col-12 col-md-6 col-lg-6 col-xl-6">
						<div class="card">
							<div class="card-header">
								<h4 class="card-title d-inline-block">Doctors </h4>
							</div>
							<div class="card-block">
								<div class="table-responsive">
									<table class="table mb-0 new-patient-table">
										 {{#each docData}}
										<tbody>
											<tr>
												<td>
													<img width="28" height="28" class="rounded-circle" src="img/user.jpg" alt=""> 
													<h2>{{this.fullname}}</h2>
												</td>
												<td>{{this.email}}</td>
												<td>{{this.phone}}</td>
												<td><button class="btn btn-primary btn-primary-one float-right">{{this.status}}</button></td>
											</tr>
									
										</tbody>
										 {{/each}}
									</table>
								</div>
							</div>
						</div>
					</div>

					<div class="col-12 col-md-6 col-lg-6 col-xl-6">
						<div class="card">
							<div class="card-header">
								<h4 class="card-title d-inline-block">Games </h4>
							</div>
							<div class="card-block">
								<div class="table-responsive">
									<table class="table mb-0 new-patient-table">
										 {{#each gameData}}
										<tbody>
											<tr>
												<td>
													<img width="28" height="28" class="rounded-circle" src="{{this.gameimage}}" alt=""> 
													
													<h2>{{this.gamename}}</h2>
												</td>
												<td>{{this.gametype}}</td>
												<td>{{this.gamecategories}}</td>
											</tr>
										</tbody>
										 {{/each}}
									</table>
								</div>
							</div>
						</div>
					</div>
				</div>
            </div>
            
        </div>
    </div>
    <div class="sidebar-overlay" data-reff=""></div>
    <script src="js/jquery-3.2.1.min.js"></script>
	<script src="js/popper.min.js"></script>
    <script src="js/bootstrap.min.js"></script>
    <script src="js/jquery.slimscroll.js"></script>
    <script src="js/Chart.bundle.js"></script>
    <script src="js/chart.js"></script>
    <script src="js/app.js"></script>

</body>

{{!-- C:\Users\Harsh\OneDrive\Desktop\New folder (4)\doctor\public\js\tagsinput.js --}}

</html>